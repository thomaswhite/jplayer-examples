var Common={cssHidden:'none',viewFull:function(obj){var objShwn=$(obj.attr('rel'));var hide=objShwn.attr('expand');if(objShwn.hasClass(hide)){obj.html('Less');objShwn.removeClass(hide);objShwn.removeClass('hide');}
else{obj.html('More');objShwn.addClass(hide);objShwn.addClass('hide');}}};var playerTab={btnId:null,init:function(){if($('#error-option').size()){$('#error-option').change(function(){if($(this).val()=='-1')$('#error-other').removeClass(Common.cssHidden);else $('#error-other').addClass(Common.cssHidden);});}
$('.jp-opt-left ul li').click(function(){playerTab.btnId=$(this).attr('id');playerTab.active(1);});$('.jp-opt-left ul ol').click(function(){playerTab.btnId=$(this).attr('id');playerTab.active(2);});$('#error-other').focus(function(){if($(this).val()=='If you encounter problems not listed above, please enter notice here.')$(this).val('');});$('#submit-error').click(function(){MP3SongPlay.sendReport($(this));return false;});},active:function(type){if(type==1){if(playerTab.btnId){var tabBtn=$('#'+playerTab.btnId);if($(tabBtn).hasClass('active')){var tab=tabBtn.toggleClass('active').attr('rel');$('#'+tab).toggle();}
else{$('.jp-opt-left ul li').removeClass('active');$('.jp-opt-content').css('display','none');var tab=tabBtn.addClass('active').attr('rel');$('#'+tab).toggle();playerTab.btnId=null;}}}
else if(type==2){if(playerTab.btnId=='jp-expand-btn'){var tabBtn=$('#'+playerTab.btnId);var tab=tabBtn.toggleClass('active').attr('class');if(tab=='active')MP3SongPlay.expandPlayer();else MP3SongPlay.unexpandPlayer();}
else if(playerTab.btnId=='jp-switch-btn'){return true;}}},}
var Playlist=function(instance,playlist,options){var self=this;this.instance=instance;this.playlist=playlist;this.options=options;this.current=LOI_VIET.PLAYLIST_STARTED;this.cssId={jPlayer:"jquery_jplayer_",interface:"jp_interface_",playlist:"jp_playlist_"};this.cssSelector={};$.each(this.cssId,function(entity,id){self.cssSelector[entity]="#"+id+self.instance;});if(!this.options.cssSelectorAncestor){this.options.cssSelectorAncestor=this.cssSelector.interface;}
$(this.cssSelector.jPlayer).jPlayer(this.options);$(this.cssSelector.interface+" .jp-previous").click(function(){self.playlistPrev();$(this).blur();return false;});$(this.cssSelector.interface+" .jp-next").click(function(event){self.playlistNext();$(this).blur();return false;});$(this.cssSelector.interface+" .jp-repeat").click(function(){self.playlistRepeat();$(this).blur();return false;});$(this.cssSelector.interface+" .jp-shuffle").click(function(){self.playlistShuffle();$(this).blur();return false;});};Playlist.prototype={displayPlaylist:function(){var self=this;$(this.cssSelector.playlist+" ul").empty();for(i=0;i<this.playlist.length;i++){var listItem="<li id='"+this.cssId.playlist+this.instance+"_line_"+i+"'>"+"<div class='col_stt'>"+(i+1)+"</div>"+"<div class='col_info'><span id='"+this.cssId.playlist+this.instance+"_item_"+i+"' title='"+this.playlist[i].name+" - "+this.playlist[i].singer+"'>"+this.playlist[i].name+"</span> - <a href='#' title='Find song of "+this.playlist[i].singer+"'>"+this.playlist[i].singer+"</a></div>"+"<div class='col_options'><a href='#' id='play_video' title='Watch clip "+this.playlist[i].name+" - "+this.playlist[i].singer+"'></a> <a href='#' id='play_song' title='Play song "+this.playlist[i].name+" - "+this.playlist[i].singer+"'></a></div></li>";$(this.cssSelector.playlist+" ul").append(listItem);var pllHeight=$(this.cssSelector.playlist+" ul");if(pllHeight.height()>169){pllHeight.addClass('hide');}
$(this.cssSelector.playlist+"_item_"+i).data("index",i).click(function(){var index=$(this).data("index");if(self.current!==index){self.playlistChange(index,true);}
else{$(self.cssSelector.jPlayer).jPlayer("play");}
$(this).blur();return false;});}},playlistInit:function(autoplay){var playlist=this;var audio=document.getElementById("jp_audio_0");if(audio==null)audio=document.getElementById("jp_flash_0");audio.addEventListener("error",function(){playlist.playlistNext();},false);if(!autoplay){var player=$(this.cssSelector.jPlayer);audio.addEventListener("progress",function(){$(player).jPlayer('play');},false);audio.addEventListener("ended",function(){playlist.playlistNext();},false);}
this.playlistChange(this.current,autoplay);},playlistConfig:function(index){$(this.cssSelector.playlist+"_line_"+this.current).removeClass("jp-playlist-current").parent().removeClass("jp-playlist-current");$(this.cssSelector.playlist+"_line_"+index).addClass("jp-playlist-current").parent().addClass("jp-playlist-current");this.current=index;var my_trackName=".jp-track-name",playlist_current_info="<div class='line_width_length'><a href='#' title='"+this.playlist[this.current].name+" - "+this.playlist[this.current].singer+"'><strong>"+this.playlist[this.current].name+"</strong></a> - <a href='#' title='Find song of "+this.playlist[this.current].singer+"'>"+this.playlist[this.current].singer+"</a></div>";$(my_trackName).html(playlist_current_info);if(this.playlist){$(this.cssSelector.jPlayer).jPlayer("setMedia",this.playlist[this.current]);}},loadData:function(code){return code;},playlistChange:function(index,autoplay){this.playlistConfig(index);if(autoplay){$(this.cssSelector.jPlayer).jPlayer("play");}
else{$(this.cssSelector.jPlayer).jPlayer("load");}},playlistNext:function(){var index=(this.current+1<this.playlist.length)?this.current+1:0;this.playlistChange(index,true);},playlistPrev:function(){var index=(this.current-1>=0)?this.current-1:this.playlist.length-1;this.playlistChange(index,true);}};